# pseudonymize patient identifiers for research

``` Python

import hmac, hashlib, json

def make_pid(value, secret, prefix="PID", length=12):
    if not value:
        return None
    d = hmac.new(secret.encode(), str(value).encode(), hashlib.sha256).hexdigest().upper()
    return f"{prefix}-{d[:length]}"

def pseudonymize_record(record, secret, keys=("patient_id","patientId","mrn","id"), out_key="pid_pseudo"):
    r = dict(record or {})
    v = next((r[k] for k in keys if r.get(k)), None)
    r[out_key] = make_pid(v, secret) if v else None
    return r


def pseudonymize_file(input_file, output_file, secret):
    """
    Read JSON file (list of patient records), pseudonymize each, and save results.
    Useful for batch research data preparation.
    """
    with open(input_file, "r") as f:
        data = json.load(f)

    results = [pseudonymize_record(rec, secret) for rec in data]
    
    with open(output_file, "w") as f:
        json.dump(results, f, indent=4)
    
    print(f"Pseudonymized {len(results)} records -> {output_file}")
    return results

if __name__ == "__main__":
    rec = {"patientId": "P001", "mrn": "7755"}
    print(pseudonymize_record(rec, "supersecret"))
    
